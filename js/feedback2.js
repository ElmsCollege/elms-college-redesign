/*
 * jSEND      v2.0.0
 * 
 * Date:      Fri Sep 24 19:35:11 2010 +0100 
 
 * Author:    Michael Kortstiege, Copyright 2010
 * Website:   http://jsend.org/ 
 *  
 * License:   Dual licensed under the MIT or GPL Version 2 licenses.
 *            (http://jsend.org/license)
 *
 * Credits:   See http://jsend.org/about/
 *   
 */
(function(x){x.jSEND=function(l){function y(j){for(var f=[],i=256,b={},c=0;c<256;c++)b[String.fromCharCode(c)]=c;var d="";c=0;for(var m=j.length;c<m;c++){var e=j.charAt(c),s=d+e;if(b[s])d=s;else{f.push(b[d]);b[s]=i++;d=""+e}}d!=""&&f.push(b[d]);return f}function v(j){for(var f=256,i=[],b=8,c=0,d=0,m=0,e=j.length;m<e;m++){c=(c<<b)+j[m];d+=b;f++;for(f>>b&&b++;d>7;){d-=8;i.push(c>>d);c&=(1<<d)-1}}i.push(d?c<<8-d:"");return i}function w(j){for(var f=[],i=0,b=0,c="",d=0,m=j.length;d<m;d++){var e=j[d];if(e>127){e-=128;b+=Math.pow(2,i)}e==0||e==34||e==37||e==38||e==39||e==43||e==61||e==92?f.push("="+String.fromCharCode(e+16)):f.push(String.fromCharCode(e));i++;if(i>6){c+=b==0||b==34||b==37||b==38||b==39||b==43||b==61||b==92?"="+String.fromCharCode(b+16)+f.join(""):String.fromCharCode(b)+f.join("");f=[];i=b=0}}c+=b==0||b==34||b==37||b==38||b==39||b==43||b==61||b==92?"="+String.fromCharCode(b+16)+f.join(""):String.fromCharCode(b)+f.join("");return c}l=String.fromCharCode(74)+l;for(var k="",g=0,t=0,h=0;h<256;h++)k+=String.fromCharCode(224);var z=256,p={};for(h=0;h<256;h++)p[String.fromCharCode(h)]=h;var u=[],n="",o="";h=0;for(var A=l.length;h<A;h++){var q=l.charAt(h),a=q.charCodeAt(0);if(a>255){var r=a;switch(a){case 8364:a=128;break;case 8218:a=130;break;case 402:a=131;break;case 8222:a=132;break;case 8230:a=133;break;case 8224:a=134;break;case 8225:a=135;break;case 710:a=136;break;case 8240:a=137;break;case 352:a=138;break;case 8249:a=139;break;case 338:a=140;break;case 381:a=142;break;case 8216:a=145;break;case 8217:a=146;break;case 8220:a=147;break;case 8221:a=148;break;case 8226:a=149;break;case 8211:a=150;break;case 8212:a=151;break;case 732:a=152;break;case 8482:a=153;break;case 353:a=154;break;case 8250:a=155;break;case 339:a=156;break;case 382:a=158;break;case 376:a=159;break}if(r!=a){q=String.fromCharCode(a);t++;g++;if(g>=256){n+=k;g=0}}else{if(g>0){n+=k.substr(0,g);g=0}n+=String.fromCharCode(parseInt(a/256))}}else{t++;g++;if(g>=256){n+=k;g=0}}r=o+q;if(p[r])o=r;else{if(a>255)q=String.fromCharCode(a%256);u.push(p[o]);p[r]=z++;o=""+q}}o!=""&&u.push(p[o]);if(g>0)n+=k.substr(0,g);k=w(v(u));if(l.length!=t){l=w(v(y(n)));return k+"=="+l}else return k}})(jQuery);(function($){var slice=Array.prototype.slice;var IS_DONTENUM_BUGGY=(function(){for(var p in{toString:1}){if(p==='toString')return false;}return true;})();var addMethods;if(IS_DONTENUM_BUGGY){addMethods=function(klass,source){if(source.toString!==Object.prototype.toString){klass.prototype.toString=source.toString;}if(source.valueOf!==Object.prototype.valueOf){klass.prototype.valueOf=source.valueOf;}for(var property in source){klass.prototype[property]=source[property];}};}else{addMethods=function(klass,source){for(var property in source){klass.prototype[property]=source[property];}};}function subclass(){}function createClass(){var parent=null,properties=slice.call(arguments,0);if(typeof properties[0]==='function'){parent=properties.shift();}function klass(){this.initialize.apply(this,arguments);}klass.superclass=parent;klass.subclasses=[];if(parent){subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass);}for(var i=0,length=properties.length;i<length;i++){addMethods(klass,properties[i]);}if(!klass.prototype.initialize){klass.prototype.initialize=emptyFunction;}klass.prototype.constructor=klass;return klass;}$.createClass=createClass;})(jQuery);(function($){$.deepClone=function(obj){if(typeof obj!=='object'||obj===null){return obj;}var clone=$.isArray(obj)?[]:{};for(var i in obj){var node=obj[i];if(typeof node=='object'){if($.isArray(node)){clone[i]=[];for(var j=0;j<node.length;j++){if(typeof node[j]!='object'){clone[i].push(node[j]);}else{clone[i].push($.deepClone(node[j]));}}}else{clone[i]=$.deepClone(node);}}else{clone[i]=node;}}return clone;}})(jQuery);(function($){$.getIEVersion=function(){var rv=-1;if(navigator.appName=='Microsoft Internet Explorer'){var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})");if(re.exec(ua)!==null){rv=parseFloat(RegExp.$1);}}return rv;}})(jQuery);if(jQuery!==undefined){var $jot=jQuery.noConflict();}
else{var filenode=document.createElement('script');filenode.src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js";filenode.onreadystatechange=function(){if(filenode.readyState==='loaded'||filenode.readyState==='complete'){filenode.onreadystatechange=null;var $jot=jQuery.noConflict();}};filenode.onload=function(){var $jot=jQuery.noConflict();};document.getElementsByTagName('head')[0].appendChild(filenode);}
if("JotformFeedbackDefaultSettings"in window){var JotformFeedbackDefaultSettings={buttonText:"Feedback",verticalTextPadding:7,horizontalTextPadding:15,buttonSpace:35,height:500,width:700,compact:true,instant:false,fontFamily:"verdana",fontColor:"#FFFFFF",fontStyle:"bold",background:"#F59202 center no-repeat",hoverBackground:"#5C5C5C",hoverFontColor:"#FFFFFF",buttonSide:"right",buttonAlign:"center",margin:50,base:"http://www.jotform.com/",formId:null,windowTitleBgColor:false,windowTitleFontColor:false,fontSize:"15px",buttonOffset:0,inlineStyle:"",iframeParameters:{},setBorderRadius:true,type:0,openOnLoad:false,reverseButtonText:false,reCalculate:true,onFormLoaded:$jot.noop,};}
if("JotformFeedbackManager"in window){var JotformFeedbackManager={buttons:{},addNewButton:function(button,reCalculate){JotformFeedbackManager.reCalculate=reCalculate;var key=button.options.buttonSide+button.options.buttonAlign;if(!$jot.isArray(JotformFeedbackManager.buttons[key])){JotformFeedbackManager.buttons[key]=[];}
JotformFeedbackManager.buttons[key][JotformFeedbackManager.buttons[key].length]=button;JotformFeedbackManager.setButtons(key);},setButtons:function(key){var total=0,i,tempButton;for(i=0;i<JotformFeedbackManager.buttons[key].length;i++){tempButton=JotformFeedbackManager.buttons[key][i];total+=tempButton.getButtonWidth();if(i!==JotformFeedbackManager.buttons[key].length-1){total+=tempButton.options.buttonOffset;}}
var current=0;for(i=0;i<JotformFeedbackManager.buttons[key].length;i++){tempButton=JotformFeedbackManager.buttons[key][i];if(JotformFeedbackManager.reCalculate){tempButton.calculateButtonPosition(total,current);}else{tempButton.calculateButtonPosition(0,0);}
tempButton.showButton();current+=tempButton.getButtonWidth();if(i!==JotformFeedbackManager.buttons[key].length-1){current+=tempButton.options.buttonOffset;}}}};}
var JotformFeedback=$jot.createClass({initialize:function(options){options.isLink=!("buttonText"in options);this.options=$jot.extend($jot.deepClone(JotformFeedbackDefaultSettings),options);this.ieVer=$jot.getIEVersion();this.ghostButton=null;this.formWindow=null;if(this.ieVer!==-1&&this.ieVer<9){this.options.compact=false;}
if(this.options.isCardForm){this.options.height='100%';this.options.width='100%';this.options.hideTitle=true;}
this.options.windowTitle=this.options.windowTitle===undefined?this.options.buttonText:this.options.windowTitle;this.options.windowTitleBgColor=this.options.windowTitleBgColor===false?this.options.background:this.options.windowTitleBgColor;this.options.windowTitleFontColor=this.options.windowTitleFontColor===false?this.options.fontColor:this.options.windowTitleFontColor;this.documanLoaded=document.readyState=='complete'||(this.jsForm&&document.readyState===undefined);if(this.options.isLink){if(!this.options.openOnLoad){this.documanLoaded?this.setLinkListener():$jot($jot.proxy(this.setLinkListener,this))}}else{if(this.documanLoaded){this.setButtons();}else{$jot($jot.proxy(this.setButtons,this));}}
if(this.options.openOnLoad===true){if(this.documanLoaded){this.showWindow();}else{$jot($jot.proxy(this.showWindow,this));}}},setButtons:function(){this.createButton();if(this.needGhostButton()){this.createGhostButton();}
JotformFeedbackManager.addNewButton(this,this.options.reCalculate);},setLinkListener:function(){var linkIdentifier='lightbox-'+this.options.formId;var $this=this;$jot("."+linkIdentifier).each(function(){$jot(this).click($jot.proxy($this.showWindow,$this));});$jot('#'+linkIdentifier).click($jot.proxy(this.showWindow,this));},needGhostButton:function(){return this.ieVer>0&&(this.options.buttonSide==="right"||this.options.buttonSide==="left");},createGhostButton:function(){var align;if(this.options.buttonSide==="right"){align="right";}else{align="left";}
this.ghostButton=$jot('<input type="button" />').css({position:"fixed",width:this.getButtonHeight()+"px",height:this.getButtonWidth()+"px",cursor:"pointer",zIndex:"998",border:"0"});this.ghostButton.css(align,0);this.setHoverProperties(this.ghostButton);this.embedButton(this.ghostButton);this.setButtonListeners(this.ghostButton);},setHoverProperties:function(button){button.hover($jot.proxy(this.mouseOver,this),$jot.proxy(this.mouseOut,this));},mouseOver:function(){this.button.css({"background":this.options.hoverBackground,"color":this.options.hoverFontColor,textShadow:"0px 0px 10px rgba(255,255,255,0.6)"});},mouseOut:function(){this.button.css({"background":this.options.background,"color":this.options.fontColor,textShadow:"none"});},getButtonWidth:function(){if((this.ieVer>-1&&this.ieVer<9)&&(this.options.buttonSide==="right"||this.options.buttonSide==="left")){return this.button[0].offsetHeight;}else{return this.button[0].offsetWidth;}},getButtonHeight:function(){if((this.ieVer>-1&&this.ieVer<9)&&(this.options.buttonSide==="right"||this.options.buttonSide==="left")){return this.button[0].offsetWidth;}else{return this.button[0].offsetHeight;}},createButton:function(){var style=this.setTransform()+"padding:"+this.options.verticalTextPadding+"px "+this.options.horizontalTextPadding+"px;"+"position:fixed;"+
this.options.buttonSide+":0;"+"visibility:hidden;"+"font-family:"+this.options.fontFamily+";"+"font-size:"+this.options.fontSize+";"+"color:"+this.options.fontColor+";"+"background:"+this.options.background+";"+"font-style: "+this.options.fontStyle+";"+"z-index: 999;"+"cursor:pointer;"+"text-align: center;"+"text-decoration: none;"+
this.options.inlineStyle+";";if(this.options.setBorderRadius){style+=this.generateBoxRadius();}
this.button=linkElement=$jot("<a />").attr({"class":'jotform-feedback-link',id:'jotform-feedback-'+this.options.formId,style:style}).html(this.options.buttonText);this.setHoverProperties(this.button);this.embedButton(this.button);this.setButtonListeners(this.button);},generateBoxRadius:function(){var radiusValues="";var shadowValues="0 0 5px";switch(this.options.buttonSide){case"bottom":radiusValues="5px 5px 0 0";break;case"top":radiusValues="0 0 5px 5px";break;case"right":if(this.options.reverseButtonText){radiusValues="0 0 5px 5px";}else{radiusValues="5px 5px 0 0";}
shadowValues="";break;case"left":if(this.options.reverseButtonText){radiusValues="5px 5px 0 0";}else{radiusValues="0 0 5px 5px";}
shadowValues="";break;}
return"-moz-border-radius: "+radiusValues+";"+"-webkit-border-radius: "+radiusValues+";"+"border-radius: "+radiusValues+";"+"-moz-box-shadow: "+shadowValues+" rgba(0,0,0,0.3);"+"-webkit-box-shadow: "+shadowValues+" rgba(0,0,0,0.3);"+"box-shadow: "+shadowValues+" rgba(0,0,0,0.3);";},setTransform:function(){if(this.options.buttonSide==="left"||this.options.buttonSide==="right"){var degree=-90;var ieDegree=3;if(this.options.reverseButtonText){degree=90;ieDegree=1;}
if(this.ieVer>-1){return this.ieVer<9?"filter: progid:DXImageTransform.Microsoft.BasicImage(rotation="+ieDegree.toString()+");":"-ms-transform:rotate("+degree.toString()+"deg);";}
return"-moz-transform:rotate("+degree.toString()+"deg);"+"-o-transform:rotate("+degree.toString()+"deg);"+"-webkit-transform:rotate("+degree.toString()+"deg);"+"transform:rotate("+degree.toString()+"deg);";}
return"";},embedButton:function(button){$jot('body').append(button);},setButtonListeners:function(button){button.click($jot.proxy(this.showWindow,this));},showButton:function(){this.button.css({visibility:""});},setOriginPointAfterRotation:function(){switch(this.options.buttonSide){case"left":if(this.ieVer===-1||this.ieVer>=9){this.button.css({marginLeft:-1*(this.getButtonWidth()/2-this.getButtonHeight()/2)+"px"});}
break;case"right":if(this.ieVer===-1||this.ieVer>=9){this.button.css({marginRight:-1*(this.getButtonWidth()/2-this.getButtonHeight()/2)+"px"});}else if(this.ieVer===8){this.button.css({marginRight:-1*(this.getButtonWidth()-this.getButtonHeight())+"px"});}
break;default:break;}},calculateButtonPosition:function(total,current){this.setOriginPointAfterRotation();switch(this.options.buttonAlign){case"top":var css={top:this.options.buttonSpace+current+"px"};if(this.needGhostButton()){this.ghostButton.css(css);}
if(this.ieVer===-1||this.ieVer>=9){css['marginTop']=(this.getButtonWidth()/2-this.getButtonHeight()/2)+"px";}
this.button.css(css);break;case"bottom":var css={bottom:this.options.buttonSpace+current+"px"};if(this.needGhostButton()){this.ghostButton.css(css);}
if(this.ieVer===-1||this.ieVer>=9){css['marginBottom']=(this.getButtonWidth()/2-this.getButtonHeight()/2)+"px";}else if(this.ieVer===8){css['marginBottom']=(this.getButtonWidth()-this.getButtonHeight())+"px"}
this.button.css(css);break;case"left":this.button.css({left:(this.options.buttonSpace+current)+"px"});break;case"right":this.button.css({right:(this.options.buttonSpace+current)+"px"});break;case"center":if(this.options.buttonSide==="left"||this.options.buttonSide==="right"){var marginValue=(this.ieVer===-1||this.ieVer>=9)?-1*(total/2-this.getButtonWidth()/2)+-1*this.getButtonHeight()/2+current:-1*total/2+current;this.button.css({top:this.options.margin+"%",marginTop:marginValue+"px"});if(this.needGhostButton()){this.ghostButton.css({top:this.options.margin+"%",marginTop:(-1*this.getButtonWidth()/2)+"px"});}}else{this.button.css({left:this.options.margin+"%",marginLeft:(-1*total/2+current)+"px"});}
break;}},showWindow:function(){var $this=this;var settings={titleBackground:this.generateBackgroundForWindow(),buttonsBackground:'#fff url('+this.options.base+'images/footer-bg.png)',background:'#f5f5f5',borderWidth:6,borderOpacity:0.5,borderRadius:'10px',contentPadding:0,closeButton:'<div style="width:22px;margin-right: 4px;margin-top: 8px; height:19px; background:url('+
this.options.base+'/images/close-wiz.png) no-repeat !important;">'+'</div>',dimColor:'#000',dimOpacity:0.8,borderColor:'#000',titleTextColor:this.options.windowTitleFontColor};var types=[{},{borderWidth:9,borderOpacity:1,borderColor:'#fff',hideTitle:true,closeButton:'<img src="'+this.options.base+'images/close-wiz-white.png" style="position:relative;top:-15px;right:-15px;" />'},{borderWidth:9,borderOpacity:0.8,hideTitle:true,closeButton:'<img src="'+this.options.base+'images/close-wiz-black.png" style="position:relative;top:-15px;right:-15px;" />',borderColor:'#000'}];settings=$jot.extend(settings,types[this.options.type]);this.windowDefaults=$jot.extend(this.windowDefaults,settings);window.wishboxCompactLoad=this.options.compact;var w=this.options.width;var h=this.options.height;if(this.options.compact&&this.options.instant){w=$jot(window).width()-100;h=$jot(window).height()-100;}
this.formWindow=this.createWindow({title:this.options.windowTitle,width:w+"px",height:h+"px",content:'<div id="js-form-content"></div>',onInsert:function(){$jot('<script type="text/javascript" src="'+$this.options.base+"jsform/"+$this.options.formId+"?appendTo=js-form-content&"+jQuery.param($this.options.iframeParameters)+'"></script>').appendTo('body');}});if(this.options.instant){this.formWindow.hide();window.wishboxInstantLoad=true;$jot('.jt-dimmer').hide();var tmp=$jot('#jotform-feedback-'+$this.options.formId).html();$jot('#jotform-feedback-'+$this.options.formId).html('<img src="http://www.jotform.com/images/loading-circle.gif" style="width:16px;float:left;margin-right:10px;"/>Loading...');JotformFeedbackManager.setButtons(this.options.buttonSide+this.options.buttonAlign);window.screenshotReady=function(){if($this.options.compact){$this.formWindow.show();$jot('.jt-dimmer').show();$jot('#wishbox-frame').show();$jot('#wishbox-frame').css({width:'100%',top:0,height:'100%',overflow:'hidden'});}else{$jot('#wishbox-frame').show('slow');}
$jot('#jotform-feedback-'+$this.options.formId).html(tmp);JotformFeedbackManager.setButtons($this.options.buttonSide+$this.options.buttonAlign);if($this.options.compact){$jot('#js-form-content iframe').css({minHeight:h-30,maxHeight:h-30});}};}else{window.wishboxInstantLoad=false;}
window.JotFormFrameLoaded=function(){if(!$this.options.isCardForm){$this.options.onFormLoaded.call($this);$jot('#js-form-content iframe').css({minHeight:$this.options.height,backgroundColor:"white"});}
if($jot('.jt-dimmer')){$jot('.jt-dimmer').click(function(){$jot('.jt-dimmer').remove();$jot('.jt-feedback').remove();})}};},createWindow:function(options){options=$jot.extend(options,this.windowDefaults);var responsiveLightboxStyle='<style type="text/css">@media screen and (max-width: 768px) { .u-responsive-lightbox { width: 90%!important; } .u-responsive-lightbox .jt-title, .u-responsive-lightbox .jt-content, .u-responsive-lightbox .js-form-content { width: 100%!important; }}</style>';$jot('head').append(responsiveLightboxStyle);var dimmer=$jot('<div class="jt-dimmer"></div>').css({position:'fixed',top:0,left:0,right:0,bottom:0,background:options.dimColor,opacity:options.dimOpacity,zIndex:10000000}).appendTo('body');var props={position:'fixed',top:this.options.isCardForm?0:'50%',left:this.options.isCardForm?0:'50%',marginLeft:this.options.isCardForm?0:"-"+(parseFloat(options.width)/2)+'px',marginTop:this.options.isCardForm?0:"-"+(parseFloat(options.height)/2)+'px',zIndex:10000001};if(this.options.isCardForm){props.height='100%';props.width='100%';}
var cont=$jot('<div class="jt-feedback u-responsive-lightbox"></div>').css(props).appendTo('body');var reCenter=function(){cont.css({marginTop:"-"+Math.floor(cont.height()/2)+"px",marginLeft:"-"+Math.floor(cont.width()/2)+"px"});win.css({overflow:'auto',maxHeight:$jot(window).height()-70});};if(!this.options.isCardForm){var i=setInterval(function(){reCenter();},200);}
var border=$jot('<div></div>').css({position:'absolute',top:-options.borderWidth,left:-options.borderWidth,right:-options.borderWidth,bottom:-options.borderWidth,opacity:options.borderOpacity,background:options.borderColor,zIndex:-1,borderRadius:options.borderRadius,MoxBorderRadius:options.borderRadius,WebkitBorderRadius:options.borderRadius}).appendTo(cont);var title=$jot('<div class="jt-title"></div>').html(options.title).css({background:options.titleBackground,width:(parseInt(options.width,10)+20),position:'relative',fontWeight:'bold',color:options.titleTextColor,textShadow:'0 1px 1px rgba(0, 0, 0, 0.5)',textIndent:'10px',borderBottom:'1px solid #8E8787',fontSize:'14px',height:'35px',lineHeight:'35px',fontFamily:'Verdana',MozBorderRadius:'3px 3px 0px 0px',WebkitBorderRadius:'3px 3px 0px 0px',borderRadius:'3px 3px 0px 0px',cursor:'move'}).appendTo(cont);var close=$jot('<div></div>').html(options.closeButton).click(function(){if(i){clearInterval(i);}
dimmer.remove();cont.remove();}).css({height:'35px',top:0,right:0,lineHeight:'35px',cursor:'pointer',position:'absolute'});if(options.hideTitle||this.options.isCardForm){title.hide();close.appendTo(cont).css({zIndex:9999,position:"absolute",right:0,top:0});}else{close.appendTo(title);}
var win=$jot('<div class="jt-content" style="-webkit-overflow-scrolling: touch; overflow: auto"></div>').html(options.content).css({background:options.background,position:'relative',width:this.options.isCardForm?'100%':(parseInt(options.width,10)+20),height:this.options.isCardForm?'100%':options.height,padding:options.contentPadding,MozBorderRadius:'0px 0px 3px 3px',WebkitBorderRadius:'0px 0px 3px 3px',borderRadius:'0px 0px 3px 3px'}).appendTo(cont);var result=options.onInsert&&options.onInsert(win);if(this.options.isCardForm){jQuery('#js-form-content, #js-form-content iframe, .jt-feedback').css({minWidth:"100%",minHeight:"100%",height:"100%",width:"100%"});}
cont.draggable({handle:title,containment:'document',iframeFix:true,start:function(){$jot('<div id="--iframe-fix"></div>').appendTo(win).css({position:'absolute',zIndex:1000,top:0,left:0,right:0,bottom:0});},stop:function(){$jot('#--iframe-fix').remove();}});return cont;},generateBackgroundForWindow:function(){if(this.options.windowTitleBgColor===false){return'url('+this.options.base+'images/title-bg.png)';}else{return this.options.windowTitleBgColor;}},showForm:function(){return this.showWindow();}});var scripts=document.getElementsByTagName("script");eval(scripts[scripts.length-1].innerHTML);
